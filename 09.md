# Les controllers

Les controllers sont des classes qui permettent de gérer les requêtes HTTP mais aussi d'y répondre. Ils sont appelés par Symfony lorsqu'une requête HTTP est reçue. Cela nous permet de mettre en place des routes.

Une route = une URL. Elle est composée de trois éléments :

- Le domaine
- Le chemin
- Les paramètres

## Le domaine

Le domaine est la partie de l'URL qui précède le chemin. Par exemple, si l'URL est `https://www.google.com/search?q=symfony`, le domaine est `www.google.com`.

## Le chemin

Le chemin est la partie de l'URL qui suit le domaine. Par exemple, si l'URL est `https://www.google.com/search?q=symfony`, le chemin est `/search`.

## Les paramètres

Les paramètres sont des variables qui sont passées dans l'URL. Par exemple, si l'URL est `https://www.google.com/search?q=symfony`, le paramètre `q` est `symfony`.

---

C'est de cette manière que nous allons intéragir avec une application web au travers de requêtes HTTP. Pour rappel, les requêtes HTTP sont :

| Méthode | Description | Cas d'utilisation |
| --- | --- | --- |
| GET | Récupération d'informations | Affichage d'une page d'accueil |
| POST | Envoi d'informations | Envoi de formulaire de contact |
| PUT | Mise à jour d'informations | Modification d'un article |
| DELETE | Suppression d'informations | Suppression d'un article |

Certaines méthodes sont plus courantes pour des appels à une API. Traditionnellement, les requêtes `GET`et `POST`sont les plus utilisées pour une application web.

---

## Création d'un controller

Pour créer un controller, il faut exécuter la commande suivante dans votre terminal :

```bash
symfony console make:controller
```
Choisissez le nom du controller, ici `Home`, puis appuyez sur Entrée.

Un nouveau fichier `HomeController.php` va être créé dans le dossier `src/Controller`.

Voici le contenu du fichier :

```php
<?php

namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;

class HomeController extends AbstractController
{
    #[Route('/', name: 'home')]
    public function index(): Response
    {
        return $this->render('home/index.html.twig');
    }
}
```

---

## Lancer le serveur web

Pour voir le résultat de la création du controller, il faut lancer le serveur web. Pour cela, exécutez la commande suivante dans votre terminal :

```bash
symfony serve
```

Les variantes de cette commande sont :

```bash
symfony server:start
```

ou

```bash
symfony server:start -d
```

Le `-d`permet de lancer le serveur sans afficher les logs dans votre terminal. Cela permet de ne pas avoir à ouvrir un second terminal. Pour voir les logs dans ce cas, exécutez la commande suivante :

```bash
symfony server:log
```

**Attention**, pensez à fermer le serveur à la fin de votre session de travail avec la commande suivante :

```bash
symfony server:stop
```

---

## Accéder à la page

Pour accéder à la page, il faut ouvrir votre navigateur à l'adresse `http://localhost:8000/home` ou `http://127.0.0.1:8000/home`.

Vous remarquez que nous sommes en HTTP et non en HTTPS. Corrigeons cela à l'aide d'une commande dans votre terminal :

```bash
symfony server:ca:install
```

Cette commande est unique et vous n'aurez pas besoin de la répéter dans le futur pour un autre projet.

---

## L'art de dumper avant de designer

À ce stade, l'application dispose de ses entités, d'une base de données et d'un route.

Il serait très peu productif de commencer à coder des vues alors que nous n'avons pas encore mis en place nos fonctionnalités. Commençons pour d'abord créer l'ensemble des routes et de ce qu'elles contiennent en terme de données issues de la base de données.

Les routes :

| Route | Description |
| --- | --- |
| Home | Affichage de la page d'accueil |
| Profile | Affichage de la page de profil d'un utilisateur |
| Notes | Affichage de la page des notes publiques |
| Note | Affichage de la page d'une note seule (publique ou privée) |
| My notes | Affichage de la page des notes de l'utilisateur |
| Category | Affichage de la page d'une catégorie |
